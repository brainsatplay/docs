<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brains@Play Docs</title>
    <link rel=stylesheet href="./../../../../brainsatplay-docs/default.css"/>
    <link rel=stylesheet href="./../../../../static/custom.css"/>
    <link rel="icon" href="./../../../../static/img/favicon.ico" type="image/x-icon" />
</head>
<body>
    <div id="brainsatplay-docs">

    <header>
        <nav><h1>Brains@Play</h1></nav>
    </header>
    <div id="brainsatplay-docs-main">
        <div id="brainsatplay-docs-sidebar"><ul data-sidebar-depth=0><a href="./../../../../roadmap.html"><li>Home</li></a><li>Repos</li><ul data-sidebar-depth=1><a href="./../../../index.html"><li>Main  Page</li></a><li>Accessify</li><ul data-sidebar-depth=2><a href="./../../../accessify/index.html"><li>Main  Page</li></a></ul><li>Datastreams Api</li><ul data-sidebar-depth=2><a href="./../../../datastreams-api/index.html"><li>Main  Page</li></a></ul><li>Components</li><ul data-sidebar-depth=2><a href="./../../../components/index.html"><li>Main  Page</li></a></ul><li>Brainsatplay</li><ul data-sidebar-depth=2><a href="./../../../brainsatplay/index.html"><li>Main  Page</li></a><li>Src</li><ul data-sidebar-depth=3><li>Core</li><ul data-sidebar-depth=4><a href="./../../../brainsatplay/src/core/index.html"><li>Main  Page</li></a></ul></ul></ul><li>Docs</li><ul data-sidebar-depth=2><a href="./../../../docs/index.html"><li>Main  Page</li></a><li>Old</li><ul data-sidebar-depth=3><li>Docs</li><ul data-sidebar-depth=4><a href="./../../../docs/old/docs/index.html"><li>Main  Page</li></a><li>Guides</li><ul data-sidebar-depth=5><a href="./../../../docs/old/docs/guides/index.html"><li>Main  Page</li></a><li>Libraries</li><ul data-sidebar-depth=6><a href="./../../../docs/old/docs/guides/libraries/index.html"><li>Main  Page</li></a></ul></ul><li>Resources</li><ul data-sidebar-depth=5><a href="./../../../docs/old/docs/resources/Algorithms.html"><li>Algorithms</li></a><a href="./../../../docs/old/docs/resources/Biosignals.html"><li>Biosignals</li></a><a href="./../../../docs/old/docs/resources/BrainScience.html"><li>Brain Science</li></a><a href="./../../../docs/old/docs/resources/Electronics.html"><li>Electronics</li></a><a href="./../../../docs/old/docs/resources/ParticipatoryResearch.html"><li>Participatory Research</li></a><a href="./../../../docs/old/docs/resources/GeneralEngineering.html"><li>General Engineering</li></a><a href="./../../../docs/old/docs/resources/Psychology.html"><li>Psychology</li></a><a href="./../../../docs/old/docs/resources/index.html"><li>Main  Page</li></a><li>Hardware</li><ul data-sidebar-depth=6><a href="./../../../docs/old/docs/resources/hardware/Development.html"><li>Development</li></a><a href="./../../../docs/old/docs/resources/hardware/ECG.html"><li>ECG</li></a><a href="./../../../docs/old/docs/resources/hardware/EDA.html"><li>EDA</li></a><a href="./../../../docs/old/docs/resources/hardware/EEG.html"><li>EEG</li></a><a href="./../../../docs/old/docs/resources/hardware/EMG.html"><li>EMG</li></a><a href="./../../../docs/old/docs/resources/hardware/FNIRS.html"><li>FNIRS</li></a><a href="./../../../docs/old/docs/resources/hardware/Microscopy.html"><li>Microscopy</li></a><a href="./../../../docs/old/docs/resources/hardware/PPG.html"><li>PPG</li></a><a href="./../../../docs/old/docs/resources/hardware/index.html"><li>Main  Page</li></a></ul><li>Software</li><ul data-sidebar-depth=6><a href="./../../../docs/old/docs/resources/software/Applications.html"><li>Applications</li></a><a href="./../../../docs/old/docs/resources/software/C++.html"><li>C++</li></a><a href="./../../../docs/old/docs/resources/software/Javascript.html"><li>Javascript</li></a><a href="./../../../docs/old/docs/resources/software/Julia.html"><li>Julia</li></a><a href="./../../../docs/old/docs/resources/software/MATLAB.html"><li>MATLAB</li></a><a href="./../../../docs/old/docs/resources/software/Python.html"><li>Python</li></a><a href="./../../../docs/old/docs/resources/software/index.html"><li>Main  Page</li></a></ul></ul></ul></ul></ul><li>Escode</li><ul data-sidebar-depth=2><a href="./../../../escode/index.html"><li>Main  Page</li></a></ul><li>Graphscript</li><ul data-sidebar-depth=2><a href="./../../Graph.html"><li>Graph</li></a><a href="./../../Service.html"><li>Service</li></a><a href="./../../index.html"><li>Main  Page</li></a><li>Services</li><ul data-sidebar-depth=3><li>Cmd</li><ul data-sidebar-depth=4><a href="./../cmd/cmd.service.html"><li>Cmd.service</li></a></ul><li>Dom</li><ul data-sidebar-depth=4><a href="./../dom/dom.service.html"><li>Dom.service</li></a></ul><li>Http</li><ul data-sidebar-depth=4><a href="./../http/http.browser.html"><li>Http.browser</li></a><a href="./../http/http.node.html"><li>Http.node</li></a></ul><li>Sse</li><ul data-sidebar-depth=4><a href="./../sse/sse.browser.html"><li>Sse.browser</li></a><a href="./../sse/sse.node.html"><li>Sse.node</li></a></ul><li>Worker</li><ul data-sidebar-depth=4><a href="./../worker/worker.html"><li>Worker</li></a><a href="./../worker/worker.service.html"><li>Worker.service</li></a></ul><li>Router</li><ul data-sidebar-depth=4><a href="./../router/Router.html"><li>Router</li></a></ul><li>Wss</li><ul data-sidebar-depth=4><a href="./../wss/wss.browser.html"><li>Wss.browser</li></a><a href="./../wss/wss.node.html"><li>Wss.node</li></a></ul><li>Webrtc</li><ul data-sidebar-depth=4><a href="./webrtc.browser.html"><li>Webrtc.browser</li></a></ul></ul></ul><li>NRF52</li><ul data-sidebar-depth=2><a href="./../../../nRF52/index.html"><li>Main  Page</li></a></ul><li>Tinybuild</li><ul data-sidebar-depth=2><a href="./../../../tinybuild/index.html"><li>Main  Page</li></a><li>Tinybuild</li><ul data-sidebar-depth=3><li>Docs</li><ul data-sidebar-depth=4><a href="./../../../tinybuild/tinybuild/docs/esbuild.html"><li>Esbuild</li></a><a href="./../../../tinybuild/tinybuild/docs/python.html"><li>Python</li></a><a href="./../../../tinybuild/tinybuild/docs/server.html"><li>Server</li></a><a href="./../../../tinybuild/tinybuild/docs/tinybuild.html"><li>Tinybuild</li></a></ul></ul></ul><li>Visualscript</li><ul data-sidebar-depth=2><a href="./../../../visualscript/index.html"><li>Main  Page</li></a></ul><li>Wasl</li><ul data-sidebar-depth=2><a href="./../../../wasl/index.html"><li>Main  Page</li></a></ul></ul><li>Resources</li><ul data-sidebar-depth=1><a href="./../../../../resources/Algorithms.html"><li>Algorithms</li></a><a href="./../../../../resources/Biosignals.html"><li>Biosignals</li></a><a href="./../../../../resources/BrainScience.html"><li>Brain Science</li></a><a href="./../../../../resources/Electronics.html"><li>Electronics</li></a><a href="./../../../../resources/GeneralEngineering.html"><li>General Engineering</li></a><a href="./../../../../resources/ParticipatoryResearch.html"><li>Participatory Research</li></a><a href="./../../../../resources/Psychology.html"><li>Psychology</li></a><a href="./../../../../resources/index.html"><li>Main  Page</li></a><li>Hardware</li><ul data-sidebar-depth=2><a href="./../../../../resources/hardware/Development.html"><li>Development</li></a><a href="./../../../../resources/hardware/ECG.html"><li>ECG</li></a><a href="./../../../../resources/hardware/EDA.html"><li>EDA</li></a><a href="./../../../../resources/hardware/EEG.html"><li>EEG</li></a><a href="./../../../../resources/hardware/EIT.html"><li>EIT</li></a><a href="./../../../../resources/hardware/EMG.html"><li>EMG</li></a><a href="./../../../../resources/hardware/FNIRS.html"><li>FNIRS</li></a><a href="./../../../../resources/hardware/Microscopy.html"><li>Microscopy</li></a><a href="./../../../../resources/hardware/PPG.html"><li>PPG</li></a><a href="./../../../../resources/hardware/index.html"><li>Main  Page</li></a></ul><li>Software</li><ul data-sidebar-depth=2><a href="./../../../../resources/software/Applications.html"><li>Applications</li></a><a href="./../../../../resources/software/C++.html"><li>C++</li></a><a href="./../../../../resources/software/Development.html"><li>Development</li></a><a href="./../../../../resources/software/Javascript.html"><li>Javascript</li></a><a href="./../../../../resources/software/Julia.html"><li>Julia</li></a><a href="./../../../../resources/software/MATLAB.html"><li>MATLAB</li></a><a href="./../../../../resources/software/Python.html"><li>Python</li></a><a href="./../../../../resources/software/index.html"><li>Main  Page</li></a></ul></ul><li>Blog</li><ul data-sidebar-depth=1></ul><li>Guides</li><ul data-sidebar-depth=1><li>Examples</li><ul data-sidebar-depth=2><a href="./../../../../guides/examples/device.html"><li>Device</li></a><a href="./../../../../guides/examples/phaser.html"><li>Phaser</li></a></ul><li>Getting Started</li><ul data-sidebar-depth=2><a href="./../../../../guides/getting-started/application.html"><li>Application</li></a><a href="./../../../../guides/getting-started/blog.html"><li>Blog</li></a><a href="./../../../../guides/getting-started/component.html"><li>Component</li></a><a href="./../../../../guides/getting-started/conventions.html"><li>Conventions</li></a><a href="./../../../../guides/getting-started/installation.html"><li>Installation</li></a><a href="./../../../../guides/getting-started/realtime.html"><li>Realtime</li></a></ul><li>Proposals</li><ul data-sidebar-depth=2><a href="./../../../../guides/proposals/hightime.html"><li>Hightime</li></a></ul></ul></ul></div>

        <section id="brainsatplay-docs-content">
            <h2 id="webrtcfrontend">WebRTCfrontend</h2>
<p>WebRTC allows peer-2-peer connections directly through the browser. Chain this with a socket server and the user router to pass session info remotely so users can connect from anywhere, with the only server overhead being the passing of needed information between clients. </p>
<p>See <code>examples/webrtc</code> for a basic implementation you can modify easily. There are a lot of options you can customize to constrain RTC sessions. A default data channel is used to pass service messages bidirectionally, or if you don't specify a callback for custom data channels (or the first channel available).</p>
<div class="brainsatplay-docs-code"><span>Code</span>
<pre><code>
import {WebRTCfrontend} from 'graphscript'

export type WebRTCProps = {
    _id?:string,
    channels?:{
        [key:string]:(true|RTCDataChannelInit|RTCDataChannel)
    },
    config?:RTCConfiguration,
    hostdescription?:RTCSessionDescriptionInit|string,
    peerdescription?:RTCSessionDescriptionInit|string,
    offer?:RTCOfferOptions,
    hostcandidates?:{[key:string]:RTCIceCandidate},
    peercandidates?:{[key:string]:RTCIceCandidate},
    answer?:RTCAnswerOptions,
    ontrack?:(ev:RTCTrackEvent)=&gt;void,
    onicecandidate?:(ev:RTCPeerConnectionIceEvent)=&gt;void,
    onicecandidateerror?:(ev:Event)=&gt;void,
    onnegotiationneeded?:(ev:Event)=&gt;void,
    ondatachannel?:(ev:RTCDataChannelEvent)=&gt;void,
    ondata?:(ev:MessageEvent&lt;any&gt;, channel:RTCDataChannel, room)=&gt;void,
    onconnectionstatechange?:(ev:Event)=&gt;void,
    oniceconnectionstatechange?:(ev:Event)=&gt;void,
    onclose?:(rtc:WebRTCInfo)=&gt;void //custom callback
}

export type WebRTCInfo = {
    _id:string,
    rtc:RTCPeerConnection,
    send:(message:any)=&gt;void, //these callbacks work on the first available data channel to call to other webrtc services
    request:(message:any, method?:string)=&gt;Promise&lt;any&gt;,
    post:(route:any, args?:any)=&gt;void,
    run:(route:any, args?:any, method?:string)=&gt;Promise&lt;any&gt;,
    subscribe:(route:any, callback?:((res:any)=&gt;void)|string)=&gt;Promise&lt;number&gt;,
    unsubscribe:(route:any, sub:number)=&gt;Promise&lt;boolean&gt;,
    terminate:()=&gt;boolean,
    graph:WebRTCfrontend
} &amp; WebRTCProps

let rtc = new WebRTCfrontend();

rtc.openRTC().then((room:WebRTCInfo) =&gt; {
    room.rtcTransmit.addEventListener('icecandidate',(ev)=&gt;{
        if(room._id) {
            if(ev.candidate) {
                //send the candidate to the other client
                socket.send(JSON.stringify({
                    _id:room._id,
                    hostdescription:room.hostdescription,
                    hostcandidates:room.hostcandidates //update endpoint with all of the host candidates
                })); //e.g. using a socket connection 
                //in another client, join this session
                //need to send this info to the server which should happen automatically via the userupdateloop
            }
        }
    })


    socket.addEventListener('message',(ev) =&gt; {
        let peerinfo = JSON.parse(ev.data);

        if(peerinfo.peerdescription) {
            rtc.answerPeer(room.rtc,peerinfo);
        }

    });
})

</code></pre></div>
<p>Then on the receiving end…</p>
<div class="brainsatplay-docs-code"><span>Code</span>
<pre><code>
socket.addEventListener('message',(ev) =&gt; {
    let hostinfo = JSON.parse(ev.data);

    if(!rtc.rooms[hostinfo._id]) {

        let room = rtc.openRTC(hostinfo as WebRTCProps).then((room:WebRTCInfo) =&gt; {

            room.rtcReceive.addEventListener('icecandidate',(ev)=&gt;{
                if(ev.candidate &amp;&amp; room._id) {
                    socket.send(JSON.stringify({
                        _id:room._id,
                        peerdescription:room.peerdescription,
                        peercandidates:room.peercandidates
                    }))
                }
            })
        })

    } else {
        for(const prop in hostinfo.hostcandidates) {
            if(!rtc.rooms[hostinfo._id].hostcandidates[prop]) {
                rtc.addIceCandidate(rtc.rooms[hostinfo._id].rtcReceive, hostinfo.hostcandidates[prop])
            }
        }
    }
})


</code></pre></div>
        </section>
    </div>
    <footer></footer>
    </div>
</body>
</html>